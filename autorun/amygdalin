#!/bin/bash
set -euo pipefail

exec &> >(tee -a /tmp/amygdalin-autorun.log)
echo "=== $(date) ==="

# Wait for DRM device nodes to appear (not just driver binding)
while ! [ -e /dev/dri/card1 ] && ! [ -e /dev/dri/card2 ]; do
    echo "Waiting for DRM devices..."
    sleep 1
done
echo "DRM devices ready: $(ls /dev/dri/card* 2>/dev/null)"

echo "starting niri-session"
niri-session
echo "niri-session exited with code $?"
